version: "3.9"
services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    platform: linux/arm64          # fine on M1/Colima
    restart: unless-stopped
    env_file:
      - ../.env
    command: >
      tunnel --config /etc/cloudflared/config.yml run
      --loglevel ${CF_LOGLEVEL}
      --metrics 0.0.0.0:${METRICS_PORT}
    volumes:
      - ../cf/config.yml:/etc/cloudflared/config.yml:ro
      - ../secrets:/etc/cloudflared:ro
    ports:
      - "${METRICS_PORT}:${METRICS_PORT}"   # optional: Prometheus/local check